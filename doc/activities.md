برنامه با نام iNet که تغییر یافته نام Hamrah هست.
این برنامه از روی چند برنامه دیگر و ابزار های مختلف ساخته شده که توسط من یعنی MehrabSp توسعه یافته.

بیس این برنامه تشکیل شده از:

OpenVpn (CakeVpn and openvpn-ics on Github)

V2ray or Xray core (V2rayNG on Github)

Buzz Vpn (Github)

و الهام گرفته شده از چند برنامه دیگر..


این برنامه بخاطر پیچیدگی های خاصی که داشت و برای درک بهتر بخش های مختلف کم اینجا تعریف میکنم.

**
کتابخانه یا سورس اصلی openvpn-ics که نسخه قدیمی ان روی CakeVpn بود یک ماژول است که من ان را تبدیل به یک کتابخانه کردم و سورس ان را در گیت هاب منتشر کردم.. این سورس با استفاده از یک Class مواردی را برای خود دریافت میکند و به بخش حذف برنامه های دلخواه یا Split Tun به صورت استاتیک هست.

بخش بعدی یعنی سورس V2ray که هسته ان Xray در گیت هاب هست با استفاده از gomobile برای اندروید بیلد گرفته شده و به یک فایل aar و jar تبدیل شده.. اما این فقط هسته ان است و سورس اصلی ان یعنی V2rayNG که برای مدیریت کانفیگ ها و لیست ها و برقراری اتصال با هسته هست. و این سورس دارای مدل مخصوص خود هست که سورس ان (V2rayNG) در گیت هاب قرار دارد. در اینجا من ان را در پکیج com.xray.lite گذاشتم و شخصی سازی هایی در ان انجام دادم و اکتیویتی های اصلی ان را تغییر نام دادم تا در جا های دیگر قابل استفاده باشد..

در ادامه سورس Buzz Vpn که من از روی تم و انیمیشن ها و UI ان الهام گرفتم و باز نویسی کردم.

** بخش های اصلی برنامه **


ما سه اکتیویتی اصلی داریم که در ان مدیریت میکنم
0- اکتیویتی لانچر (اجرا کننده)
1- اکتیویتی خانه
2- اکتیویتی لاگین

این سه اکتیویتی از هر طرف با هم ارتباط دارن

**
- اکتیویتی خانه: اکتیویتی های دیگر از جمله سرور ها و فیلترشکن داخل این اکتیویتی اصلی هستن
- اکتیویتی لاگین: این اکتیویتی اطاعات یوزرنیم و پسورد کاربر را در ایپی بررسی و ذخیره و در صورت درست بودن کاربر را به اکتیویتی خانه میبرد

اکتیویتی خانه و لاگین باهم ارتباط دارن.. برای خروج از حساب و برای ورود به حساب..


اما
قبل از ورود به اکتیویتی های اصلی برنامه ما یک لایه دارد که همان اکتیویتی لانچر یا اجرا کننده هست که یک اسپلش اسکرین هم هست.


این اکتیویتی لانچر چند تا کار را انجام میدهد
1- با ایپی ارتباط برقرار میکند
2- مقادیر را از ایپی میگیرد و ذخیره میکند
3- مقادیر را برای دفعه بعدی ذخیره و بررسی میکند
4- اکتیویتی های اصلی را اجرا میکند

کار اصلی این اکتیویتی گرفتن اطلاعات سرور ها و کاربر و بررسی وضعیت کاربر هست و اجرای دو اکتیویتی اصلی هست
یعنی بعد از ورود کاربر به برنامه اکتیویتی لانچر به این صورت بررسی میکند:

- اگر کاربر قبلا ورود کرده بود یوزرنیم و پسوردی که قبلا ذخیره شده را دریافت میکند و به ایپی ( همان ایپی که اکتیویتی لاگین استفاده میکند ) ارسال میکند و توکن جدید کاربر را دریافت میکند.

* این کار باید توسط یک کلاس جدا انجام شود ( این کلاس توسط اکتیویتی لانچر و لاگین اجرا میشود ) و خروجی ان به صورت یک بولین باشد و توکن دریافت شده از این کلاس که در اکتیویتی لاگین هم استفاده میشود در همان اکتیویتی در ApiData (static) ذخیره شود.

* توکن ها هر دفعه تغییر میکند پس باید ان ها را در هرصورت برای اجرای برنامه و دریافت سرور ها از ایپی دریافت کرد

- اگر کاربر قبلا ورود نکرده بود اکتیویتی لانچر کاربر را به اکتیویتی لاگین میبرد تا برنامه ادامه فعالیت دریافت توکن و اطلاعات را از انجا ادامه دهد.

 *
\|/ حالا ما توکن جدید را دریافت کرده ایم
\ /

برای ورود به اکتیویتی خانه از هر طرف (اکتیویتی لاگین و لانچر) نیاز داریم که با توکنی که از کاربر داریم لیست سرور ها را دریافت کنیم!

* یعنی قبل از ورود به اکتیویتی خانه یا بعد از درستی سنجی از اکتیویتی لانچر و لاگین این را باید دریافت کنیم.

* یک کلاس جدا تعریف میکنیم ( این کلاس توسط اکتیویتی لاگین و لانچر اجرا میشود) مانند کلاس دریافت توکن.. که این کلاس توکن را از ApiData دریافت میکند و با callback به ما یک بولین میدهد. که اطلاعات از توکنی که ارسال شده ذخیره شده یا خیر. در این کلاس ما با توکنی که داریم اطلاعات سرور را در GlobalData ذخیره میکنیم.
این کلاس هم باید دو کار را انجام دهد.
اول باید توکن را بررسی کند که خالی نباشد و دوم باید توکن را به ایپی برای دریافت OSID ارسال کند تا ان عدد را بدست اورد
حالا عدد بدست امده را در بدنه همراه با توکن به ایپی جدید برای دریافت لیست سرور ها ارسال میکند. اطلاعات را استخراج و ذخیره میکند.


* این اطلاعات نباید خالی باشد

برای اطمینان از خالی نبودن همه اطلاعاتی که ضروری هست یک لایه کوچک در اکتیویتی خانه میسازیم و هنگام اجرای ان بررسی میکنیم که اگر مشکلی در برنامه وجود داشت همه اطلاعات از جمله اطلاعات یوزرنیم و پسورد کاربر را خالی میکنیم و کاربر را دوباره به اکتیویتی لاگین میفرستیم **




